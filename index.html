async function fetchTrainData() {
  const tbody = document.querySelector("#train-table tbody");
  tbody.innerHTML = "<tr><td colspan='4'>ì—´ì°¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>";

  try {
    const res = await fetch("/api/train");
    const data = await res.json();
    const rows = data.realtimeArrivalList || [];

    // ğŸ” ì „ì²´ ì‘ë‹µ í™•ì¸
    console.log("â–¶ ì „ì²´ ì‘ë‹µ rows:", rows);

    // âœ… 1ì°¨ í•„í„°: ìƒí–‰ 1í˜¸ì„  + ì¢…ì°©ì§€ ì¡°ê±´
    const filtered = rows.filter(train => {
      const isLine1 = train.subwayId === "1001";
      const isUp = (train.updnLine || "").includes("ìƒí–‰") || train.updnLine === "0";
      const terminal = train.bstatnNm || '';
      const isTargetDest = ["ì†Œìš”ì‚°", "ì˜ì •ë¶€", "ë™ë‘ì²œ", "ì—°ì²œ", "ì–‘ì£¼", "ë„ë´‰ì‚°"]
        .some(dest => terminal.includes(dest));
      return isLine1 && isUp && isTargetDest;
    });

    console.log("â–¶ í•„í„° í›„ ì—´ì°¨ ìˆ˜:", filtered.length);
    filtered.forEach(train => {
      console.log(
        `[FILTERED] trainNo=${train.trainNo}`,
        `statnNm=${train.statnNm}`,
        `arvlMsg3=${train.arvlMsg3}`,
        `bstatnNm=${train.bstatnNm}`,
        `updnLine=${train.updnLine}`
      );
    });

    // âœ… ì—­ë³„ ë§¤ì¹­ í™•ì¸
    const stationMap = {};
    STATIONS.forEach(station => {
      const matches = filtered.filter(train => {
        const msg = (train.arvlMsg3 || "").replace(/\s/g, "");
        const ok = isHeadingToStation(train, station);
        if (ok) {
          console.log(`âœ… [ë§¤ì¹­] ì—­=${station} | ì—´ì°¨ë²ˆí˜¸=${train.trainNo} | arvlMsg3=${train.arvlMsg3}`);
        }
        return ok;
      });
      console.log(`â–¶ ${station} ë§¤ì¹­ëœ ì—´ì°¨:`, matches.map(t => t.trainNo));
      stationMap[station] = matches.sort((a, b) => parseInt(a.barvlDt || 9999) - parseInt(b.barvlDt || 9999));
    });

    // âœ… í‘œ ë Œë”ë§
    tbody.innerHTML = "";
    STATIONS.forEach(station => {
      const trains = stationMap[station] || [];
      if (trains.length === 0) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td data-label="í˜„ì¬ìœ„ì¹˜">${station}</td>
          <td data-label="ì—´ì°¨ë²ˆí˜¸" colspan="3">-</td>
        `;
        tbody.appendChild(tr);
      } else {
        trains.forEach(train => {
          const arrivalTime = getEstimatedArrivalTime(station);
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td data-label="í˜„ì¬ìœ„ì¹˜">${station}</td>
            <td data-label="ì—´ì°¨ë²ˆí˜¸">${train.trainNo || "-"}</td>
            <td data-label="ì¢…ì°©ì—­">${train.bstatnNm || "-"}</td>
            <td data-label="ì„œìš¸ì—­ ë„ì°©ì˜ˆì •">${arrivalTime}</td>
          `;
          tbody.appendChild(tr);
        });
      }
    });
  } catch (e) {
    console.error(e);
    tbody.innerHTML = "<tr><td colspan='4'>âŒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</td></tr>";
  }
}
