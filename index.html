<!DOCTYPE html>
<html lang="ko">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
Â  <title>ì„œìš¸ì—­ 1í˜¸ì„  ìƒí–‰ ì—´ì°¨ ì¡°íšŒ</title>
Â  <style>
Â  Â  body { font-family: sans-serif; padding: 1.5em; background: #f9f9f9; }
Â  Â  h2 { color: #0052cc; font-size: 1.3rem; margin-bottom: 1em; }
Â  Â  ul { list-style: none; padding: 0; }
Â  Â  li {
Â  Â  Â  background: #fff;
Â  Â  Â  margin-bottom: 0.5em;
Â  Â  Â  padding: 0.8em;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
Â  Â  Â  transition: all 0.2s;
Â  Â  }
Â  Â  li.highlighted { /* ê°•ì¡°ë  ì—´ì°¨ì— ì ìš©í•  ìŠ¤íƒ€ì¼ */
Â  Â  Â  font-weight: bold;
Â  Â  Â  color: #0052cc; /* ê¸€ììƒ‰ ê°•ì¡° */
Â  Â  Â  border: 1px solid #007bff; /* í…Œë‘ë¦¬ ì¶”ê°€ */
Â  Â  Â  background: #e6f2ff; /* ê°•ì¡° ë°°ê²½ìƒ‰ */
Â  Â  }
Â  Â  button {
Â  Â  Â  margin-top: 1rem;
Â  Â  Â  padding: 0.6em 1em;
Â  Â  Â  font-size: 1rem;
Â  Â  Â  border: none;
Â  Â  Â  background: #007bff;
Â  Â  Â  color: white;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  </style>
</head>
<body>
Â  <h2>ğŸš‡ ì„œìš¸~êµ¬ë¡œ êµ¬ê°„ 1í˜¸ì„  ìƒí–‰ ì—´ì°¨ í˜„í™©<br>(ë¶ë¶€ë°©ë©´ì€ ê°•ì¡°)</h2>
Â  <ul id="train-list"><li>ì—´ì°¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li></ul>
Â  <button id="refresh-btn">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>

Â  <script>
Â  Â  // ì„œìš¸ì—­ê¹Œì§€ì˜ ì—­ ìˆœì„œì™€ ê° ì—­ì—ì„œì˜ ì„œìš¸ì—­ê¹Œì§€ì˜ ëŒ€ëµì ì¸ ì†Œìš” ì‹œê°„ (ë¶„ ë‹¨ìœ„)
Â  Â  // ì‹¤ì œ ì´ë™ ì‹œê°„ì€ ìƒí™©ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ëŒ€ëµì ì¸ ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
Â  Â  const stationOrder = {
Â  Â  Â  "êµ¬ë¡œ": 8,
Â  Â  Â  "ì‹ ë„ë¦¼": 7,
Â  Â  Â  "ì˜ë“±í¬": 6,
Â  Â  Â  "ì‹ ê¸¸": 5,
Â  Â  Â  "ëŒ€ë°©": 4,
Â  Â  Â  "ë…¸ëŸ‰ì§„": 3,
Â  Â  Â  "ìš©ì‚°": 2,
Â  Â  Â  "ë‚¨ì˜": 1,
Â  Â  Â  "ì„œìš¸": 0
Â  Â  };
Â  Â  // ì—­ê°„ í‰ê·  ì†Œìš” ì‹œê°„ (ë¶„) - ëŒ€ëµì ì¸ ê³„ì‚°ìš©
Â  Â  const averageTimePerStation = 2; // ì—­ë‹¹ í‰ê·  2ë¶„ ì†Œìš” ê°€ì •

Â  Â  async function fetchTrainData() {
Â  Â  Â  const list = document.getElementById("train-list");
Â  Â  Â  list.innerHTML = "<li>ì—´ì°¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>"; // ë¡œë”© ë©”ì‹œì§€
Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch("/api/train");
Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  const rows = data.realtimeArrivalList || [];

Â  Â  Â  Â  const guroSeoulStations = [
Â  Â  Â  Â  Â  "êµ¬ë¡œ", "ì‹ ë„ë¦¼", "ì˜ë“±í¬", "ì‹ ê¸¸", "ëŒ€ë°©", "ë…¸ëŸ‰ì§„", "ìš©ì‚°", "ë‚¨ì˜", "ì„œìš¸"
Â  Â  Â  Â  ];

Â  Â  Â  Â  // 1. 1í˜¸ì„  ìƒí–‰ ì—´ì°¨ ì¤‘ ì§€ì •ëœ 9ê°œ ì—­ì— í•´ë‹¹í•˜ëŠ” ì—´ì°¨ë§Œ í•„í„°ë§ (ëª¨ë‘ í‘œì‹œ)
Â  Â  Â  Â  const relevantTrains = rows.filter(train => {
Â  Â  Â  Â  Â  const isLine1 = train.subwayId === "1001";
Â  Â  Â  Â  Â  const isUp = (train.updnLine || "").includes("ìƒí–‰") || train.updnLine === "0";
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  // í˜„ì¬ ì—­ ì •ë³´ íŒŒì‹±ì„ ë” ê°•ê±´í•˜ê²Œ (arvlMsg2, arvlMsg3, statnNm ëª¨ë‘ ê³ ë ¤)
Â  Â  Â  Â  Â  let currentStationCandidate = (train.arvlMsg2 || train.arvlMsg3 || train.statnNm || '');
Â  Â  Â  Â  Â  // 'ë„ì°©', 'ì¶œë°œ', 'ì§„ì…' ê°™ì€ ë©”ì‹œì§€ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ statnNmì„ ìš°ì„  ì‚¬ìš©
Â  Â  Â  Â  Â  if (currentStationCandidate.includes('ë„ì°©') || currentStationCandidate.includes('ì¶œë°œ') || currentStationCandidate.includes('ì§„ì…')) {
Â  Â  Â  Â  Â  Â    currentStationCandidate = train.statnNm || currentStationCandidate;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  // ì‹¤ì œ ì—­ëª…ë§Œ ì¶”ì¶œ (ì˜ˆ: 'ì„œìš¸ì—­ ì§„ì…' -> 'ì„œìš¸')
Â  Â  Â  Â  Â  let detectedStation = '';
Â  Â  Â  Â  Â  for (const st of guroSeoulStations) {
Â  Â  Â  Â  Â  Â  Â  if (currentStationCandidate.includes(st)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  detectedStation = st;
Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  return isLine1 && isUp && detectedStation !== '';
Â  Â  Â  Â  });

Â  Â  Â  Â  // ë„ì°© ì˜ˆì • ì‹œê°„(barvlDt) ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
Â  Â  Â  Â  const sortedTrains = relevantTrains.sort((a, b) => parseInt(a.barvlDt || "99999") - parseInt(b.barvlDt || "99999"));


Â  Â  Â  Â  list.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ë¹„ìš°ê¸°
Â  Â  Â  Â  if (sortedTrains.length === 0) {
Â  Â  Â  Â  Â  list.innerHTML = "<li>âš ï¸ ì„œìš¸~êµ¬ë¡œ êµ¬ê°„ì˜ ìƒí–‰ ì—´ì°¨ê°€ ì—†ìŠµë‹ˆë‹¤.</li>";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  sortedTrains.forEach(train => {
Â  Â  Â  Â  Â  Â  const terminal = train.bstatnNm || ''; // ì¢…ì°©ì—­
Â  Â  Â  Â  Â  Â  const seconds = parseInt(train.barvlDt || "0");
Â  Â  Â  Â  Â  Â  const minutes = Math.floor(seconds / 60);
Â  Â  Â  Â  Â  Â  const remainSec = seconds % 60;
Â  Â  Â  Â  Â  Â  const arrivalTimeText = (minutes === 0)
Â  Â  Â  Â  Â  Â  Â  ? `ì•½ ${remainSec}ì´ˆ í›„ ë„ì°© ì˜ˆì •`
Â  Â  Â  Â  Â  Â  Â  : `ì•½ ${minutes}ë¶„ ${remainSec}ì´ˆ í›„ ë„ì°© ì˜ˆì •`;

Â  Â  Â  Â  Â  Â  // í˜„ì¬ ì—´ì°¨ê°€ ìœ„ì¹˜í•œ ì—­ (statnNmì„ ìš°ì„  ì‚¬ìš©)
Â  Â  Â  Â  Â  Â  let currentDisplayStation = train.statnNm || train.arvlMsg2 || '';
Â  Â  Â  Â  Â  Â  // arvlMsg2ê°€ 'ë„ì°©'ì´ë‚˜ 'ì¶œë°œ'ê³¼ ê°™ì€ ë©”ì‹œì§€ì¼ ê²½ìš°, statnNmì„ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©
Â  Â  Â  Â  Â  Â  if (train.arvlMsg2 && (train.arvlMsg2.includes('ë„ì°©') || train.arvlMsg2.includes('ì¶œë°œ'))) {
Â  Â  Â  Â  Â  Â  Â  Â  Â currentDisplayStation = train.statnNm || train.arvlMsg2 || '';
Â  Â  Â  Â  Â  Â  }
            // ìµœì¢…ì ìœ¼ë¡œ guroSeoulStations ì¤‘ í•˜ë‚˜ë¡œ ë§¤í•‘ (ì •í™•í•œ ì—­ëª… í‘œì‹œë¥¼ ìœ„í•¨)
            let parsedStation = '';
            for (const st of guroSeoulStations) {
                if (currentDisplayStation.includes(st)) {
                    parsedStation = st;
                    break;
                }
            }
            // ì°¾ì§€ ëª»í–ˆìœ¼ë©´ ì›ë³¸ ë©”ì‹œì§€ ê·¸ëŒ€ë¡œ ì‚¬ìš©
            if (parsedStation === '') parsedStation = currentDisplayStation;


Â  Â  Â  Â  Â  Â  // ê°•ì¡° ëŒ€ìƒ ì¢…ì°©ì—­ ëª©ë¡ (ë¶ë¶€ ë°©ë©´)
Â  Â  Â  Â  Â  Â  const targetDestinations = ["ì†Œìš”ì‚°", "ì˜ì •ë¶€", "ë™ë‘ì²œ", "ì—°ì²œ", "ì–‘ì£¼", "ë„ë´‰ì‚°"];
Â  Â  Â  Â  Â  Â  const isTargetDestination = targetDestinations.some(dest => terminal.includes(dest));

Â  Â  Â  Â  Â  Â  const li = document.createElement("li");
Â  Â  Â  Â  Â  Â  let additionalInfo = '';

Â  Â  Â  Â  Â  Â  if (isTargetDestination) {
Â  Â  Â  Â  Â  Â  Â  li.classList.add("highlighted");

Â  Â  Â  Â  Â  Â  Â  // ì„œìš¸ì—­ê¹Œì§€ì˜ ì˜ˆìƒ ì´ë™ ì‹œê°„ ê³„ì‚°
Â  Â  Â  Â  Â  Â  Â  // í˜„ì¬ ì—­ ì •ë³´ë¥¼ stationOrder ë§µì—ì„œ ì°¾ì•„ì„œ ë‚¨ì€ ì—­ ê°œìˆ˜ ê³„ì‚°
Â  Â  Â  Â  Â  Â  Â  let stationsRemainingToSeoul = 0;
Â  Â  Â  Â  Â  Â  Â  // parsedStationì„ ê¸°ì¤€ìœ¼ë¡œ stationOrderì—ì„œ ì°¾ìŒ
Â  Â  Â  Â  Â  Â  Â  if (stationOrder[parsedStation] !== undefined) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  stationsRemainingToSeoul = stationOrder[parsedStation];
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  const estimatedTravelTimeToSeoulMin = stationsRemainingToSeoul * averageTimePerStation;
Â  Â  Â  Â  Â  Â  Â  if (stationsRemainingToSeoul > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  additionalInfo = `, ì„œìš¸ì—­ê¹Œì§€ ì•½ ${estimatedTravelTimeToSeoulMin}ë¶„ ì†Œìš”`;
Â  Â  Â  Â  Â  Â  Â  } else if (stationsRemainingToSeoul === 0 && parsedStation.includes("ì„œìš¸")) { // parsedStation ì‚¬ìš©
Â  Â  Â  Â  Â  Â  Â  Â  Â  additionalInfo = `, ì„œìš¸ì—­ ë„ì°©`;
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ìš”ì²­ì— ë”°ë¼ "í•´ë‹¹í•˜ëŠ” ì—­ ì´ë¦„"ì„ ê²°ê³¼ê°’ì˜ ê°€ì¥ ì™¼ìª½ì— í‘œê¸°
Â  Â  Â  Â  Â  Â  // `parsedStation`ì„ ì‚¬ìš©í•˜ì—¬ ì •í™•í•œ ì—­ ì´ë¦„ì„ í‘œì‹œí•©ë‹ˆë‹¤.
Â  Â  Â  Â  Â  Â  li.textContent = `${parsedStation} (${arrivalTimeText}, ì¢…ì°©: ${terminal}${additionalInfo})`;
Â  Â  Â  Â  Â  Â  list.appendChild(li);
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  } catch (e) {
Â  Â  Â  Â  list.innerHTML = "<li>âŒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</li>";
Â  Â  Â  Â  console.error("ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e);
Â  Â  Â  }
Â  Â  }

Â  Â  // ì´ˆê¸° ë¡œë“œ ë° 1ë¶„ë§ˆë‹¤ ìƒˆë¡œê³ ì¹¨
Â  Â  fetchTrainData();
Â  Â  setInterval(fetchTrainData, 60000);
Â  Â  document.getElementById("refresh-btn").addEventListener("click", fetchTrainData);
Â  </script>
</body>
</html>